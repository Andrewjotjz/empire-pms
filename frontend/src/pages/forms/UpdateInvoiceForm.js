// {"invoices": [
//         {
//             "_id": "67046886d4ecf0e44b23ea52",
//             "invoice_ref": "TEST0001INVOICE5",
//             "supplier": "6684f2e5b8c9196c4081d9f9",
//             "invoice_issue_date": "2024-10-08T00:00:00.000Z",
//             "invoice_received_date": "2024-10-07T00:00:00.000Z",
//             "invoice_due_date": "2024-11-08T00:00:00.000Z",
//             "order": "66fe34090402e84be8bead22",
//             "products": [
//                 {
//                     "product_obj_ref": "66907e46e79c95672dbb141e",
//                     "invoice_product_location": "Level 1",
//                     "invoice_product_qty_a": 0,
//                     "invoice_product_price_unit": 4.8,
//                     "invoice_product_gross_amount_a": 19.44,
//                     "_id": "67046886d4ecf0e44b23ea53"
//                 },
//                 {
//                     "product_obj_ref": "66907e46e79c95672dbb14ea",
//                     "invoice_product_location": "Level 1",
//                     "invoice_product_qty_a": 1,
//                     "invoice_product_price_unit": 25.28,
//                     "invoice_product_gross_amount_a": 25.28,
//                     "_id": "67046886d4ecf0e44b23ea54"
//                 },
//                 {
//                     "product_obj_ref": "66fe393bd0c2f4da51b361cf",
//                     "invoice_product_location": "No location",
//                     "invoice_product_qty_a": 1,
//                     "invoice_product_price_unit": 100,
//                     "invoice_product_gross_amount_a": 100,
//                     "_id": "67046886d4ecf0e44b23ea55"
//                 }
//             ],
//             "custom_products": [
//                 {
//                     "custom_product_name": "Extra Labour",
//                     "custom_product_location": "No location",
//                     "custom_order_qty": 1,
//                     "custom_order_price": 100,
//                     "custom_order_gross_amount": 100,
//                     "_id": "67046886d4ecf0e44b23ea56"
//                 },
//                 {
//                     "custom_product_name": "Custom made test 1",
//                     "custom_product_location": "",
//                     "custom_order_qty": 1,
//                     "custom_order_price": 100,
//                     "custom_order_gross_amount": 100,
//                     "_id": "67046886d4ecf0e44b23ea57"
//                 },
//                 {
//                     "custom_product_name": "Custom made test 2",
//                     "custom_product_location": "",
//                     "custom_order_qty": 1,
//                     "custom_order_price": 100,
//                     "custom_order_gross_amount": 100,
//                     "_id": "67046886d4ecf0e44b23ea58"
//                 },
//                 {
//                     "custom_product_name": "Custom made test 3",
//                     "custom_product_location": "",
//                     "custom_order_qty": 1,
//                     "custom_order_price": 100,
//                     "custom_order_gross_amount": 100,
//                     "_id": "67046886d4ecf0e44b23ea59"
//                 }
//             ],
//             "invoiced_delivery_fee": 100,
//             "invoiced_other_fee": 100,
//             "invoiced_credit": 0,
//             "invoiced_raw_total_amount_incl_gst": 819.19,
//             "invoiced_calculated_total_amount_incl_gst": 819.19,
//             "invoice_is_stand_alone": false,
//             "invoice_internal_comments": "",
//             "invoice_isarchived": false,
//             "invoice_status": "To review",
//             "createdAt": "2024-10-07T23:02:30.092Z",
//             "updatedAt": "2024-10-07T23:02:30.092Z",
//             "__v": 0
//         }
//     ],
// "products": [
//         {
//             "product_obj_ref": {
//                 "_id": "66fe393bd0c2f4da51b361cf",
//                 "product_sku": "TEST0001",
//                 "product_name": "TEST0001",
//                 "product_types": "Others",
//                 "product_actual_size": 1,
//                 "product_next_available_stock_date": null,
//                 "supplier": "6684f2e5b8c9196c4081d9f9",
//                 "alias": "668e17d0342c271b1a28a0e6",
//                 "product_isarchived": false,
//                 "createdAt": "2024-10-03T06:27:07.761Z",
//                 "updatedAt": "2024-10-03T06:27:07.761Z",
//                 "__v": 0
//             },
//             "productprice_obj_ref": {
//                 "_id": "66fe407ed0c2f4da51b37621",
//                 "product_obj_ref": "66fe393bd0c2f4da51b361cf",
//                 "product_unit_a": "carton",
//                 "product_number_a": 1,
//                 "product_price_unit_a": 100,
//                 "product_unit_b": "unit",
//                 "product_number_b": 5,
//                 "product_price_unit_b": 20,
//                 "price_fixed": false,
//                 "product_effective_date": "2024-10-03T00:00:00.000Z",
//                 "projects": [
//                     "66863ebaee939207f5689529"
//                 ],
//                 "createdAt": "2024-10-03T06:58:06.437Z",
//                 "updatedAt": "2024-10-03T06:58:06.437Z",
//                 "__v": 0
//             },
//             "order_product_location": "TEST",
//             "order_product_qty_a": 1,
//             "order_product_qty_b": 5,
//             "order_product_price_unit_a": 100,
//             "order_product_gross_amount": 100,
//             "_id": "67061035fb559f210d814282"
//         },
//         {
//             "product_obj_ref": {
//                 "_id": "66fe393bd0c2f4da51b361cf",
//                 "product_sku": "TEST0001",
//                 "product_name": "TEST0001",
//                 "product_types": "Others",
//                 "product_actual_size": 1,
//                 "product_next_available_stock_date": null,
//                 "supplier": "6684f2e5b8c9196c4081d9f9",
//                 "alias": "668e17d0342c271b1a28a0e6",
//                 "product_isarchived": false,
//                 "createdAt": "2024-10-03T06:27:07.761Z",
//                 "updatedAt": "2024-10-03T06:27:07.761Z",
//                 "__v": 0
//             },
//             "productprice_obj_ref": {
//                 "_id": "66fe407ed0c2f4da51b37621",
//                 "product_obj_ref": "66fe393bd0c2f4da51b361cf",
//                 "product_unit_a": "carton",
//                 "product_number_a": 1,
//                 "product_price_unit_a": 100,
//                 "product_unit_b": "unit",
//                 "product_number_b": 5,
//                 "product_price_unit_b": 20,
//                 "price_fixed": false,
//                 "product_effective_date": "2024-10-03T00:00:00.000Z",
//                 "projects": [
//                     "66863ebaee939207f5689529"
//                 ],
//                 "createdAt": "2024-10-03T06:58:06.437Z",
//                 "updatedAt": "2024-10-03T06:58:06.437Z",
//                 "__v": 0
//             },
//             "order_product_location": "TEST",
//             "order_product_qty_a": 1,
//             "order_product_qty_b": 5,
//             "order_product_price_unit_a": 100,
//             "order_product_gross_amount": 100,
//             "_id": "6706104dfb559f210d8142d4"
//         },
//         {
//             "product_obj_ref": {
//                 "_id": "66fe393bd0c2f4da51b361cf",
//                 "product_sku": "TEST0001",
//                 "product_name": "TEST0001",
//                 "product_types": "Others",
//                 "product_actual_size": 1,
//                 "product_next_available_stock_date": null,
//                 "supplier": "6684f2e5b8c9196c4081d9f9",
//                 "alias": "668e17d0342c271b1a28a0e6",
//                 "product_isarchived": false,
//                 "createdAt": "2024-10-03T06:27:07.761Z",
//                 "updatedAt": "2024-10-03T06:27:07.761Z",
//                 "__v": 0
//             },
//             "productprice_obj_ref": {
//                 "_id": "66fe407ed0c2f4da51b37621",
//                 "product_obj_ref": "66fe393bd0c2f4da51b361cf",
//                 "product_unit_a": "carton",
//                 "product_number_a": 1,
//                 "product_price_unit_a": 100,
//                 "product_unit_b": "unit",
//                 "product_number_b": 5,
//                 "product_price_unit_b": 20,
//                 "price_fixed": false,
//                 "product_effective_date": "2024-10-03T00:00:00.000Z",
//                 "projects": [
//                     "66863ebaee939207f5689529"
//                 ],
//                 "createdAt": "2024-10-03T06:58:06.437Z",
//                 "updatedAt": "2024-10-03T06:58:06.437Z",
//                 "__v": 0
//             },
//             "order_product_location": "TEST",
//             "order_product_qty_a": 1,
//             "order_product_qty_b": 5,
//             "order_product_price_unit_a": 100,
//             "order_product_gross_amount": 100,
//             "_id": "67061063fb559f210d814dab"
//         }
//     ]
// }

const currentOrder = {
    // Your currentOrder object here...
};

// Extract the list of product IDs from the 'products' array in the currentOrder
const productIds = currentOrder.products.map(product => product.product_obj_ref._id);

// Now, iterate over each invoice and check if the products match with any product ID
let totalQty = currentOrder.invoices.reduce((sum, invoice) => {
    const invoiceProductQtySum = invoice.products.reduce((invoiceSum, invoiceProduct) => {
        // Check if the current product's product_obj_ref is present in the currentOrder's products list
        if (productIds._id.includes(invoiceProduct._id)) {
            // Add the invoice product quantity to the sum if there's a match
            return invoiceSum + invoiceProduct.invoice_product_qty_a;
        }
        return invoiceSum;
    }, 0);

    return sum + invoiceProductQtySum;
}, 0);

console.log("Total quantity of matched products:", totalQty);


// ! *****************************

{/* Based on previous invoice */}
<td className="border border-gray-300 px-1 py-2 bg-gray-100">
<label>{currentOrder.invoices.reduce((sum, invoice) => {
    // Reduce over each invoice to accumulate the quantities
    const invoiceProductQtySum = invoice.products.reduce((invoiceSum, invoiceProduct) => {
        // Check if the current product's _id matches the invoice product's product_obj_ref
        if (prod.product_obj_ref._id === invoiceProduct.product_obj_ref) {
            // Add the invoice product quantity to the sum if there's a match
            return invoiceSum + invoiceProduct.invoice_product_qty_a;
        }
        return invoiceSum;
    }, 0);

    return sum + invoiceProductQtySum;
}, 0)}</label>

<label className="ml-1 text-xs opacity-50 col-span-1 text-nowrap">
    {prod.productprice_obj_ref.product_unit_a}
</label>
</td>